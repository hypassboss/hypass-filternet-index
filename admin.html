<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>HYPASS V2 ç¸½éƒ¨æˆ°æƒ…å®¤</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body { font-family: sans-serif; background: #f4f6f8; margin: 0; display: flex; height: 100vh; }
    .sidebar { width: 220px; background: #0a0a0c; color: #fff; padding: 20px 0; }
    .nav-btn { display: block; width: 100%; padding: 15px 20px; text-align: left; background: none; border: none; color: #aaa; cursor: pointer; font-size: 16px; border-left: 4px solid transparent; }
    .nav-btn:hover { color: #fff; background: #222; }
    .nav-btn.active { color: #00D100; border-left-color: #00D100; background: #1a1e1a; font-weight: bold; }
    .main-content { flex: 1; padding: 30px; overflow-y: auto; }
    .panel { display: none; background: #fff; padding: 25px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
    .panel.active { display: block; animation: fadeIn 0.3s; }
    h2 { color: #333; border-bottom: 2px solid #eee; padding-bottom: 10px; margin-top: 0; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 14px; }
    th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
    th { background: #f8f9fa; color: #555; }
    .badge { padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; background:#e0e0e0; color:#333; }
    .badge.aqi { background: #ffebee; color: #d32f2f; }
    .badge.weather { background: #e3f2fd; color: #1976d2; }
    .badge.health { background: #e8f5e9; color: #388e3c; }
  </style>
</head>
<body>

  <div class="sidebar">
    <h2 style="color:#00D100; padding: 0 20px; border:none;">HYPASS ADMIN</h2>
    <button class="nav-btn active" onclick="switchTab('esg', this)">ğŸŒ ESG æˆ°æƒ…å®¤</button>
    <button class="nav-btn" onclick="switchTab('push', this)">ğŸ’¬ æ™ºæ…§æ¨æ’­å¼•æ“</button>
    <button class="nav-btn" onclick="switchTab('dispatch', this)">ğŸ“¦ æƒæå‡ºè²¨ç«™</button>
    <button class="nav-btn" onclick="switchTab('crm', this)">ğŸ‘¥ CRM å®¢æˆ¶ç®¡ç†</button>
  </div>

  <div class="main-content">
    
    <div id="panel-esg" class="panel active"><h2>ğŸŒ HYPASS ç¶ èƒ½è²¢ç»ç¸½è¦½</h2><p>è¼‰å…¥ä¸­...</p></div>

    <div id="panel-push" class="panel">
      <h2>ğŸ’¬ AI æ™ºæ…§æ¨æ’­å¼•æ“ (å‹•æ…‹æƒ…å¢ƒåº«)</h2>
      <p style="color:#666;">ç³»çµ±å°‡æ–¼æ¯æ—¥èƒŒæ™¯è‡ªå‹•æƒæå…¨å°è»Šä¸»ç‹€æ…‹èˆ‡æ°£è±¡é€£ç·šï¼Œè‹¥ç¬¦åˆä»¥ä¸‹æ¢ä»¶å°‡è‡ªå‹•ç™¼é€ LINE é€šçŸ¥ã€‚</p>
      <table id="push-table">
        <thead><tr><th>é¡åˆ¥</th><th>æƒ…å¢ƒè¦å‰‡åç¨±</th><th>è§¸ç™¼é‚è¼¯æ¢ä»¶</th><th>è‡ªå‹•æ¨æ’­æ–‡æ¡ˆå…§å®¹</th><th>ç‹€æ…‹</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <div id="panel-dispatch" class="panel"><h2>ğŸ“¦ B2C æƒæå‡ºè²¨å·¥ä½œç«™</h2></div>
    <div id="panel-crm" class="panel"><h2>ğŸ‘¥ CRM å®¢æˆ¶ç®¡ç†</h2></div>

  </div>

  <script>
    const supabaseClient = supabase.createClient('https://qznvabjtxcbffjryfgqi.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF6bnZhYmp0eGNiZmZqcnlmZ3FpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE1Nzc2NzUsImV4cCI6MjA4NzE1MzY3NX0.chreegQgxCJI4cZcvwsED8Cvh7XJ-E0P7G_wzpVMe6k');

    function switchTab(id, btn) {
      document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
      document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
      document.getElementById('panel-'+id).classList.add('active');
      btn.classList.add('active');
      if(id === 'push') loadPushRules();
    }

    async function loadPushRules() {
      const { data } = await supabaseClient.from('notification_rules').select('*').order('id', { ascending: true });
      let html = '';
      if(data) {
        data.forEach(r => {
          let badgeCls = r.category.toLowerCase();
          html += `<tr>
            <td><span class="badge ${badgeCls}">${r.category}</span></td>
            <td style="font-weight:bold;">${r.rule_name}</td>
            <td style="font-family:monospace; color:#888;">${r.trigger_condition}</td>
            <td>${r.message_template}</td>
            <td><span style="color:green;">â— å•Ÿç”¨ä¸­</span></td>
          </tr>`;
        });
      }
      document.getElementById('push-table').querySelector('tbody').innerHTML = html || '<tr><td colspan="5">è®€å–ä¸­...</td></tr>';
    }
  </script>
</body>
</html>
